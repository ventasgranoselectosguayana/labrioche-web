(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.jQuery;var a=e.n(t);function n(e){const t=a()(e).next().is(".hasDatepicker")?"minDate":"maxDate",n="minDate"===t?a()(e).next():a()(e).prev(),o=a()(e).datepicker("getDate");a()(n).datepicker("option",t,o),a()(e).change()}function o(){return{language:{errorLoading:()=>wc_enhanced_select_params.i18n_searching,inputTooLong(e){const t=e.input.length-e.maximum;return 1===t?wc_enhanced_select_params.i18n_input_too_long_1:wc_enhanced_select_params.i18n_input_too_long_n.replace("%qty%",t)},inputTooShort(e){const t=e.minimum-e.input.length;return 1===t?wc_enhanced_select_params.i18n_input_too_short_1:wc_enhanced_select_params.i18n_input_too_short_n.replace("%qty%",t)},loadingMore:()=>wc_enhanced_select_params.i18n_load_more,maximumSelected:e=>1===e.maximum?wc_enhanced_select_params.i18n_selection_too_long_1:wc_enhanced_select_params.i18n_selection_too_long_n.replace("%qty%",e.maximum),noResults:()=>wc_enhanced_select_params.i18n_no_matches,searching:()=>wc_enhanced_select_params.i18n_searching}}}window.window.serializeJSON,a()(document).on("wooccm-enhanced-between-dates",(function(e){a()(".wooccm-enhanced-between-dates").filter(":not(.enhanced)").each((function(){a()(this).find("input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,onSelect(){n(a()(this))}}),a()(this).find("input").each((function(){n(a()(this))}))}))})),a()(document).on("wooccm-enhanced-options",(function(e){a()("table.wc_gateways tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,helper:(e,t)=>(t.children().each((function(){a()(this).width(a()(this).width())})),t.css("left","0"),t),start(e,t){t.item.css("background-color","#f6f6f6")},stop(e,t){t.item.removeAttr("style"),t.item.trigger("updateMoveButtons")},update(e,t){a()(this).find("tr").each((function(e,t){const n=a()(t).find("input.check");n.length>0&&n.prop("disabled",0==e),a()(t).find("input.add-order").val(e).trigger("change")}))}}),a()(".wooccm-enhanced-options").each((function(){const e=a()(this),t=e.find(".add-option"),n=e.find(".remove-options");t.on("click",(function(t){const o=e.find("tbody > tr"),i=o.children("td").children(".label").toArray().reduce(((e,t)=>{const n=Number(a()(t).prop("name").match(/\d+/)[0]);return n>e?n:e}),0)+1,c=o.first().clone().html().replace(/options\[([0-9]+)\]/g,"options["+i+"]").replace('disabled="disabled"',"").replace('checked="checked"',"").replace('<input value="0"','<input value="'+i+'"').replace('<input value="0"','<input value="'+i+'"');o.last().after(a()("<tr>"+c+"</tr>")).find("input").trigger("change"),n.removeProp("disabled")})),n.on("click",(function(t){e.find("tbody > tr").length<2||e.find("tbody > tr").length<=e.find("tr > td.check-column input:checked").length?alert("You cant delete all options."):(e.find("tr > td.check-column input:checked").closest("tr").remove(),e.find("tbody > tr").first().find("input").trigger("change"))})),a()(document).ready((function(){a()("input[type=radio][name=default]").click((function(){if(1==a()(this).data("waschecked"))a()(this).prop("checked",!1),a()(this).data("waschecked",!1),a()(this).trigger("change");else{const e=a()(this);e.data("waschecked",!0),a()("input[type=radio][name=default]").each((function(){const t=a()(this);e.val()!==t.val()&&(t.prop("checked",!1),t.data("waschecked",!1))}))}}))}))}))})),a()(document).on("wooccm-enhanced-select",(function(e){a()(".wooccm-enhanced-select").filter(":not(.enhanced)").each((function(){const e=a().extend({minimumResultsForSearch:10,allowClear:!!a()(this).data("allow_clear"),placeholder:a()(this).data("placeholder")},o());a()(this).selectWoo(e).addClass("enhanced")})),a()(".wooccm-product-search").filter(":not(.enhanced)").each((function(){let e={allowClear:!!a()(this).data("allow_clear"),placeholder:a()(this).data("placeholder"),minimumInputLength:a()(this).data("minimum_input_length")?a()(this).data("minimum_input_length"):"3",escapeMarkup:e=>e,ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",delay:250,data(e){return{term:e.term,action:a()(this).data("action")||"wooccm_select_search_products",security:wc_enhanced_select_params.search_products_nonce,selected:a()(this).select2("val")||0,exclude:a()(this).data("exclude"),include:a()(this).data("include"),limit:a()(this).data("limit"),display_stock:a()(this).data("display_stock")}},processResults(e){const t=[];return e&&a().each(e,(function(e,a){t.push({id:e,text:a})})),{results:t}},cache:!0}};if(e=a().extend(e,o()),a()(this).attr("name"),a()(this).selectWoo(e).addClass("enhanced"),a()(this).data("sortable")){const e=a()(this),t=a()(this).next(".select2-container").find("ul.select2-selection__rendered");t.sortable({placeholder:"ui-state-highlight select2-selection__choice",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",stop(){a()(t.find(".select2-selection__choice").get().reverse()).each((function(){const t=a()(this).data("data").id,n=e.find('option[value="'+t+'"]')[0];e.prepend(n)}))}})}else a()(this).prop("multiple")&&a()(this).on("change",(function(){const e=a()(this).children();e.filter("option").sort((function(e,t){const a=e.text.toLowerCase(),n=t.text.toLowerCase();return a>n?1:a<n?-1:0})),a()(this).html(e)}))}))})),a()(".wooccm-enhanced-search").filter(":not(.enhanced)").each((function(){let e={allowClear:!!a()(this).data("allow_clear"),placeholder:a()(this).data("placeholder"),minimumInputLength:a()(this).data("minimum_input_length")||"3",escapeMarkup:e=>e,ajax:{url:wooccm_admin.ajax_url,dataType:"json",cache:!0,delay:250,data(e){return{term:e.term,key:a()(this).data("key"),action:"wooccm_search_field",nonce:wooccm_admin.nonce}},processResults(e,t){const n=[];return e&&a().each(e,(function(e,t){n.push({id:e,text:t})})),{results:n}}}};e=a().extend(e,o()),a()(this).select2(e).addClass("enhanced")})),window.wp.util,window.window.Backbone,window.window.uiDatepicker,function(e){let t,a=0;const n=function(){e("#wooccm_modal").removeClass("processing")};_.mixin({decodeString:e=>(new DOMParser).parseFromString(`<!doctype html><body>${e}`,"text/html").body.textContent,sortOptions:e=>_.sortBy(e,(function(e){return e.order})),escapeHtml:e=>e.replace("&amp;",/&/g).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#039;/g,"'"),getFormData(e){const t=e.serializeJSON({checkboxUncheckedValue:"false",parseBooleans:!0,parseNulls:!0}),a=Object.assign({},wooccm_field.args);return Object.assign(a,t)}});const o=Backbone.Model.extend({defaults:Object.create(wooccm_field.args)}),i=Backbone.View.extend({initialize(t){const a=e(t.target).closest("[data-field_id]").data("field_id"),n=new o;n.set({id:a}),new c({model:n}).render()}}),c=Backbone.View.extend({events:{"change input":"enableSave","change textarea":"enableSave","change select":"enableSave","click .media-modal-backdrop":"close","click .media-modal-close":"close","click .media-modal-prev":"edit","click .media-modal-next":"edit","click .media-modal-tab":"tab","change .media-modal-parent":"parent","change .media-modal-render-tabs":"renderTabs","change #datepicker-enhance-bahaviour":"renderPanels","change #timepicker-enhance-bahaviour":"renderPanels","change #datepicker-date-limit":"renderPanels",'change .media-modal-render-panels input[type="text"]':"renderPanels","change .media-modal-render-info":"renderInfo","submit .media-modal-form":"submit"},templates:{},initialize(){_.bindAll(this,"open","tab","edit","load","render","close","submit","parent"),this.init(),this.open()},init(){this.templates.window=wp.template("wooccm-modal-main")},assign(e,t){e.setElement(this.$(t)).render()},updateModel(e){e&&e.preventDefault();const t=this.$el.find("#wooccm_modal").find("form"),a=_.getFormData(t);this.model.set(a)},reload(e){this.$el.find("#wooccm_modal").hasClass("reload")?location.reload():this.remove()},close(t){t.preventDefault(),this.undelegateEvents(),e(document).off("focusin"),e("body").removeClass("modal-open"),this.$el.find("#wooccm_modal").addClass("reload"),this.reload(t)},enableSave(t){e(".media-modal-submit").prop("disabled",!1),this.updateModel(t)},disableSave(t){e(".media-modal-submit").prop("disabled",!0)},tab(t){t.preventDefault();const a=this.$el.find("#wooccm_modal"),n=e(t.currentTarget),o=a.find("ul.wc-tabs"),i=n.find("a").attr("href").replace("#","");o.find(".active").removeClass("active"),n.addClass("active"),this.model.attributes.panel=i,this.model.changed.panel=i,this.renderPanels(t)},renderTabs(e){this.renderPanels(e),this.tabs.render()},renderPanels(e){this.updateModel(e),this.panels.render()},render(){const e=this;e.$el.html(e.templates.window(e.model.attributes)),this.tabs=new s({model:e.model}),this.panels=new d({model:e.model}),this.info=new l({model:e.model}),this.assign(this.tabs,"#wooccm-modal-tabs"),this.assign(this.panels,"#wooccm-modal-panels"),this.assign(this.info,"#wooccm-modal-info")},open(t){e("body").addClass("modal-open").append(this.$el),null!=this.model.attributes.id?this.load():_.delay((function(){n()}),100)},load(){const t=this;null!=t.model.attributes.id?e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_load_field",nonce:wooccm_field.nonce,field_id:this.model.attributes.id},dataType:"json",type:"POST",complete(){n()},error(){alert("Error!")},success(e){console.log("response",e),e.success?(t.model.set(e.data),t.render()):alert(e.data)}}):t.render()},edit(n){n.preventDefault();let o=this,i=e(n.target),c=parseInt(e(".wc_gateways tr[data-field_id]").length),s=parseInt(o.model.get("order"));a++,t&&clearTimeout(t),t=setTimeout((function(){s=i.hasClass("media-modal-next")?Math.min(s+a,c):Math.max(s-a,1),o.model.set({id:parseInt(e(".wc_gateways tr[data-field_order="+s+"]").data("field_id"))}),a=0,o.load()}),300)},submit(t){t.preventDefault();const a=this,n=a.$el.find("#wooccm_modal"),o=n.find(".settings-save-status .spinner"),i=n.find(".settings-save-status .saved");return e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_save_field",nonce:wooccm_field.nonce,field_data:JSON.stringify(a.model.attributes)},dataType:"json",type:"POST",beforeSend(){e(".media-modal-submit").prop("disabled",!0),o.addClass("is-active")},complete(){i.addClass("is-active"),o.removeClass("is-active"),_.delay((function(){i.removeClass("is-active")}),1e3)},error(e){alert("Error!")},success(e){e.success?null==a.model.attributes.id&&(n.addClass("reload"),a.reload(t),a.close(t)):alert(e.data)}}),!1},renderInfo(){this.info.render()},parent(t){t.preventDefault();const a=this,n=a.$el.find("#wooccm_modal").find(".attachment-details");return this.updateModel(t),e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_load_parent",nonce:wooccm_field.nonce,conditional_parent_key:a.model.attributes.conditional_parent_key},dataType:"json",type:"POST",beforeSend(){a.disableSave(),n.addClass("save-waiting")},complete(){n.addClass("save-complete"),n.removeClass("save-waiting"),a.enableSave()},error(){alert("Error!")},success(e){e.success?(a.model.attributes.parent=e.data,a.model.changed.parent=e.data,a.renderInfo()):alert(e.data)}}),!1}}),s=Backbone.View.extend({templates:{},initialize(){this.templates.window=wp.template("wooccm-modal-tabs")},render(){this.model.attributes.panel="general",this.$el.html(this.templates.window(this.model.attributes))}}),d=Backbone.View.extend({templates:{},initialize(){this.templates.window=wp.template("wooccm-modal-panels")},render(){this.$el.html(this.templates.window(this.model.attributes)),this.$el.trigger("wooccm-enhanced-options"),this.$el.trigger("wooccm-enhanced-select"),this.$el.trigger("init_tooltips")}}),l=Backbone.View.extend({templates:{},initialize(){this.templates.window=wp.template("wooccm-modal-info")},render(){this.$el.html(this.templates.window(this.model.attributes)),this.$el.trigger("wooccm-enhanced-select"),this.$el.trigger("init_tooltips")}});e("#wooccm_billing_settings_add, #wooccm_shipping_settings_add, #wooccm_additional_settings_add").on("click",(function(e){e.preventDefault(),new i(e)})),e("#wooccm_billing_settings_reset, #wooccm_shipping_settings_reset, #wooccm_additional_settings_reset").on("click",(function(t){return t.preventDefault(),e(t.target),!!confirm(wooccm_field.message.reset)&&(e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_reset_fields",nonce:wooccm_field.nonce},dataType:"json",type:"POST",beforeSend(){},complete(){},error(){alert("Error!")},success(e){e.success?location.reload():alert(e.data)}}),!1)})),e(".wooccm_billing_settings_edit, .wooccm_shipping_settings_edit, .wooccm_additional_settings_edit").on("click",(function(e){e.preventDefault(),new i(e)})),e(".wooccm_billing_settings_delete, .wooccm_shipping_settings_delete, .wooccm_additional_settings_delete").on("click",(function(t){t.preventDefault();const a=e(t.target).closest("[data-field_id]"),n=a.data("field_id");return!!confirm(wooccm_field.message.remove)&&(e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_delete_field",nonce:wooccm_field.nonce,field_id:n},dataType:"json",type:"POST",beforeSend(){},complete(){},error(){alert("Error!")},success(e){e.success?a.remove():alert(e.data)}}),!1)})),e(document).on("click",".wooccm-field-toggle-attribute",(function(t){t.preventDefault();const a=e(this),n=a.closest("tr"),o=a.find(".woocommerce-input-toggle");return e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_toggle_field_attribute",nonce:wooccm_field.nonce,field_attr:e(this).data("field_attr"),field_id:n.data("field_id")},dataType:"json",type:"POST",beforeSend(e){o.addClass("woocommerce-input-toggle--loading")},success(e){!0===e.data?(o.removeClass("woocommerce-input-toggle--enabled, woocommerce-input-toggle--disabled"),o.addClass("woocommerce-input-toggle--enabled"),o.removeClass("woocommerce-input-toggle--loading")):!0!==e.data&&(o.removeClass("woocommerce-input-toggle--enabled, woocommerce-input-toggle--disabled"),o.addClass("woocommerce-input-toggle--disabled"),o.removeClass("woocommerce-input-toggle--loading"))}}),!1})),e(document).on("change",".wooccm-field-change-attribute",(function(t){t.preventDefault();const a=e(this),n=a.closest("tr");return e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_change_field_attribute",nonce:wooccm_field.nonce,field_attr:a.data("field_attr"),field_value:a.val(),field_id:n.data("field_id")},dataType:"json",type:"POST",beforeSend(e){a.prop("disabled",!0)},success(e){console.log(e.data)},complete(e){a.prop("disabled",!1)}}),!1}))}(jQuery),(window.tiktok=window.tiktok||{}).backend={}})();